<!DOCTYPE html>
<html>
  <head>
    <title><%= title %> Dashboard</title>
  </head>
  <style>
    #sidebar .nav-item {
      width: 100%;
      height: 0;
      padding-bottom: 100%;
      position: relative;
    }

    #sidebar .nav-link {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  />
  <body>
    <nav class="navbar navbar-light bg-light">
      <div class="container-fluid">
        <div class="div">Navbar</div>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarToggleExternalContent"
          aria-controls="navbarToggleExternalContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </nav>
    <div class="container-fluid d-flex align-items-center px-0">
      <div class="col-1 bg-dark h-100 side-nav p-0" style="flex-grow: 2">
        <nav class="bg-light border-right" id="sidebar">
          <div
            class="sidebar-sticky py-3 d-flex flex-column justify-content-evenly"
          >
            <ul class="nav flex-column">
              <li class="nav-item w-100 h-100">
                <a class="nav-link active" href="#">Link 1</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Link 2</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Link 3</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="col-11 w-100 px-0 d-flex flex-column justify-content-start">
        <div class="container-fluid top-area align-items-center px-0">
          <div
            class="row d-flex justify-content-between align-items-center mx-3"
          >
            <div class="col-4"><h1>Dashboard</h1></div>
            <div class="col-4 d-flex justify-content-end">
              <button>
                <i class="fa-sharp fa-solid fa-plus"></i>
              </button>
              <select
                class="time-view-select form-select"
                aria-label="Default select example"
              >
                <option value="day" selected>Today's View</option>
                <option value="week">Weekly View</option>
                <option value="month">Monthly View</option>
                <option value="year">Yearly View</option>
              </select>
            </div>
          </div>
          <hr class="hr w-100 my-0" />
        </div>
        <div class="container my-3">
          <div class="row d-flex justify-content-between">
            <div
              class="col-2 d-flex align-items-center justify-content-center mt-0"
            >
              <button id="prev-button">
                <i class="fa-solid fa-arrow-left"></i>
              </button>
            </div>
            <div class="col-8 text-center">
              <h2><%=urlDate %></h2>
            </div>
            <div
              class="col-2 w-100 text-right d-flex align-items-center justify-content-center"
            >
              <button id="next-button">
                <i class="fa-solid fa-arrow-right"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="container unique-page">
          <div class="row d-flex justify-content-between">
            <div class="col-7 bg-light mx-2">7</div>
            <div class="col-4 bg-light mx-2">4</div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script
  src="https://kit.fontawesome.com/19b6f885a9.js"
  crossorigin="anonymous"
></script>
<script>
  const timeViewSelect = document.querySelector(".time-view-select");
  const path = window.location.pathname;
  let selectedValue = "day";

  if (path.includes("/week")) {
    selectedValue = "week";
  } else if (path.includes("/month")) {
    selectedValue = "month";
  } else if (path.includes("/year")) {
    selectedValue = "year";
  }

  timeViewSelect.value = selectedValue;

  timeViewSelect.addEventListener("change", (e) => {
    const selectedValue = timeViewSelect.value;
    let newLink = `/dashboard/${selectedValue}/`;
    console.log(`New link: ${newLink}`);
    window.location.href = newLink;
  });

  const prevButton = document.getElementById("prev-button");
  const nextButton = document.getElementById("next-button");
  const timeFrameSelect = document.querySelector(".time-view-select");

  // Set up click event listeners
  prevButton.addEventListener("click", decrementDate);
  nextButton.addEventListener("click", incrementDate);

  function decrementDate() {
    const urlDate = getUrlDate();
    const timeFrame = getTimeFrame();
    const newDate = getNextDate(urlDate, timeFrame, -1);
    const newLink = `/dashboard/${timeFrame}/${newDate}`;
    window.location.href = newLink;
  }

  function incrementDate() {
    const urlDate = getUrlDate();
    const timeFrame = getTimeFrame();
    const newDate = getNextDate(urlDate, timeFrame, 1);
    const newLink = `/dashboard/${timeFrame}/${newDate}`;
    window.location.href = newLink;
    e.preventDefault()
  }

  function getUrlDate() {
    const urlParts = window.location.href.split("/");
    return urlParts[urlParts.length - 1];
  }

  function getTimeFrame() {
    return timeFrameSelect.value;
  }
  
  function getNextDate(currentDate, timeFrame, increment) {
  const dateParts = currentDate.split('-');
  const year = parseInt(dateParts[dateParts.length - 1]);
  const month = parseInt(dateParts[0]) - 1;
  const day = parseInt(dateParts[1]);
  let newDate;

  switch (timeFrame) {
    case 'day':
      newDate = new Date(year, month, day + increment);
      return `${padZero(newDate.getMonth() + 1)}-${padZero(newDate.getDate())}-${newDate.getFullYear()}`;
      case 'week':
      const currentWeek = getWeekNumber(new Date(year, month, day));
      newWeek = currentWeek + increment;
      if (newWeek < 1 || newWeek > 53) {
        return null; // Invalid week number
      }
    case 'month':
      newDate = new Date(year, month + increment, 1);
      return `${padZero(newDate.getMonth() + 1)}-${newDate.getFullYear()}`;
    case 'year':
      newDate = new Date(year + increment, 0, 1);
      return `${newDate.getFullYear()}`;
  }
}

// let newWeekNumber = getWeekNumber(newDate);
//   if (newWeekNumber === 0) {
//     // If the last week of the previous year is week 0, this is the first week of the new year
//     newWeekNumber = 1;
//   }

function padZero(number) {
  return number < 10 ? '0' + number : number;
}

function getStartOfWeek(date) {
  const day = date.getDay();
  const diff = date.getDate() - day + (day == 0 ? -6 : 1);
  const startOfWeek = new Date(date.setDate(diff));
  return `${padZero(startOfWeek.getMonth() + 1)}-${padZero(startOfWeek.getDate())}`;
}

function getWeekNumber(d) {
  const onejan = new Date(d.getFullYear(), 0, 1);
  const weekNo = Math.ceil(((d.getTime() - onejan.getTime()) / 86400000 + onejan.getDay() + 1) / 7);
  console.log(weekNo)
  return weekNo;
}

function getEndOfWeek(date) {
  const day = date.getDay();
  const diff = date.getDate() + (6 - day);
  const endOfWeek = new Date(date.setDate(diff));
  return `${padZero(endOfWeek.getMonth() + 1)}-${padZero(endOfWeek.getDate())}`;
}
</script>
